<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Main</title>
</head>

<body>


<button onclick="location.href='hjoinForm'" value="회원가입">회원가입</button>

<button th:if="${session.loginId eq null}" onclick="location.href='hLoginForm'" value="로그인">로그인</button>

<button th:if="${session.loginId ne null}" onclick="location.href='hLogout'" value="로그아웃">로그아웃</button>


<button onclick="location.href='hList'" value="회원목록">회원목록</button>

<button onclick="location.href='img'"> 이미지</button>

<button onclick="location.href='PostForm'" value="회원목록">게시글 작성</button>


<form action="img" method="GET">

    <input type="text" name="PIMG">
    <input type="submit" value="전송">

</form>
<div th:each="list : ${postList}" class="img_box fadein" style="text-align: center">
    <img th:src="@{/photo/{PfileName}(PfileName=${list.PfileName})}" width="500px" height="500px" class="test_image">
</div>
</body>


</html>


<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>

    var loading = false;    //중복실행여부 확인 변수
    var page=4;   //불러올 페이지

    /*nextpageload function*/


    function next_load() {
        $.ajax({
            type: "POST",
            url: "/ajaxPost",
            data: {'page': page},
            dataType: 'json',
            success: function (data) {

                for(i=0; i<data.length;i++) {
                    console.log("성공");
                    /* 이미지 동적 추가 */

                    var append_node = "";
                    append_node += "<div class='img_box fadein' style=\"text-align: center\">";
                    console.log(data[i].pfileName);
                    append_node += "<img width='500px' height='500px' class='test_image' src='/photo/"+data[i].pfileName+"'>";
                    append_node += "</div>";
                    $('body').append(append_node)
                }
                    page=page+1; //페이지 증가
                    loading = false;    //실행 가능 상태로 변경

            }
            , error: function (xhr, status, error) {
            console.log("실패");
            }
        });
    }

    //스크롤 맨 아래일 때 실행
    $(window).scroll(function () {
        if ($(window).scrollTop() + 200 >= $(document).height() - $(window).height()) {
            if (!loading)    //실행 가능 상태라면?
            {
                loading = true; //실행 불가능 상태로 변경
                next_load();
            } else            //실행 불가능 상태라면?
            {

            }
        }
    });

</script>


</html>
