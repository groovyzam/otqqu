<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<form action="HpwModify" method="POST">
<table>

    <tr>
        <th>현재 패스워드</th>
        <td><input type="password"  id="uHpw" onkeyup="idOverlap()" >
        <span id="confirmId"></span></td>
    </tr>


    <tr>
    <th>변경할 패스워드</th>
    <td><input type="password" name="Hpw" id="newHpw" onkeyup="pwCheck()" />

        <span class="section_pw_check_text"></span>
    </td>
</tr>


<tr>
    <th>Password Confirm</th>
    <td><input type="password" required id="pwConfirm" onkeyup="pwEqual()">
        <span class="section_pw_check_text"></span></td>
</tr>

    <td>
        <input type="submit" value="비밀번호 변경">
    </td>
</table>
</form>


</body>

<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">

//기존 비밀번호 확인
    function idOverlap() {
        let idCheck = document.getElementById("uHpw").value;
        let confirmMId = document.getElementById("confirmMId");
        let idPass = false;

        $.ajax({
            type: "POST",
            url: "A_pwOverlap",
            data: {"Hpw": idCheck},
            async: false,
            dataType: "text",
            success: function (data) {
                // 성공시
                if (data == "OK") {
                    confirmId.style.color = "#0000ff";
                    confirmId.innerHTML = "현재 비밀번호가 일치합니다.";
                    idPass = true;

                } else {
                    confirmId.style.color = "#ff0000";
                    confirmId.innerHTML = "현재 비밀번호가 일치하지 않습니다.";
                    idPass = false;
                }
            },
            error: function () {
                // 실패시
                alert("idOverlap함수 통신실패")
            }
        });
        return idPass;
    }


    //비밀번호 정규식
    let pw = document.getElementById("newHpw");
    let pwTxt = document.getElementsByClassName("section_pw_check_text");

    function pwCheck() {
        let pw1 = pw.value;
        let pattern1 = /[0-9]/;
        let pattern2 = /[a-zA-Z]/;
        let pattern3 = /[~!@\#$%<>^&*]/;
        let pwSecurityCheck = false;

        if (!pattern1.test(pw1) || !pattern2.test(pw1) || !pattern3.test(pw1) || pw1.length < 6) {
            pwTxt[0].innerHTML = '영문, 숫자, 특수문자를 포함한 6자리이상의 비밀번호를 입력해 주세요';
            pwTxt[0].style.color = 'red';
            pwSecurityCheck = false;
        } else {
            pwTxt[0].innerHTML = '안전한 비밀번호 입니다';
            pwTxt[0].style.color = 'green';
            pwSecurityCheck = true;
        }

        return [pw1, pwSecurityCheck];
    }


    // 비밀번호 확인
    let pwC = document.getElementById("pwConfirm");

    function pwEqual() {
        let pw1 = pw.value;
        let pw2 = pwC.value;
        let pwEqualCheck = false;

        if (pw1 !== pw2 || pw2.length == 0) {
            pwTxt[1].innerHTML = '비밀번호가 같지 않습니다';
            pwTxt[1].style.color = 'red';
            pwEqualCheck = false;
        } else {
            pwTxt[1].innerHTML = '비밀번호가 같습니다';
            pwTxt[1].style.color = 'green';
            pwEqualCheck = true;
        }

        return [pw2, pwEqualCheck];
    }

    function check() {
        let [pw1, pwSecurityCheck] = pwCheck();
        let [pw2, pwEqualCheck] = pwEqual();
        console.log(`pw1`);
        console.log(`pw2`);
        if (pw1 === pw2) {
            section_form_name.submit();
        } else if (pwSecurityCheck == false) {
            document.getElementById('pw').focus();
        } else if (pwEqualCheck == false) {
            document.getElementById('pwConfirm').focus();
        }
    }

</script>
</html>